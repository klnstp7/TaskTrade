@{
    Layout = "~/Views/Shared/_LayoutPage.cshtml";
}

<div class="layer_notice" id="extractiondialog">
    <h2><i class="fa fa-close pull-right" style="" onclick="cancelextractiondialog()"></i><span style="">选择项目</span></h2>
    <form id="selected">
        <table id="projectTable" class="sm">
            <tr>
                <td class="left">流水号</td>
                <td><input type="text" value="" id="Search_ProjectNo" name="Search_ProjectNo" /></td>
                <td class="left">报告号</td>
                <td><input type="text" value="" id="Search_ReportNo" name="Search_ReportNo" /></td>
                <td class="left">小区名称</td>
                <td><input type="text" value="" id="Search_ResidentialAreaName" name="Search_ResidentialAreaName" /></td>
                <td class="left">项目地址</td>
                <td><input type="text" value="" id="Search_ProjectAddress" name="Search_ProjectAddress" /></td>
                <td style="width:auto">
                    <button type="button" class="btn btn-sm btn-search" onclick="SearchProject()" id="search"><span class="search-icon btn-icon"></span>查询</button>
                    <button type="button" class="project-btn-4" onclick="GetSelectRow()">确认选择</button>
                </td>
            </tr>
        </table>
    </form>
    <table id="tablist"></table>
</div>
<script type="text/javascript">
    var dialog;
    $(function () {
        tableint();
    });

    $("#selected").validate({
        rules: {
            //流水号
            Search_ProjectNo: {
                maxlength: 50,
            },
            //报告号
            Search_ReportNo: {
                maxlength: 50,
            },
            //小区名称
            Search_ResidentialAreaName: {
                stringCheck: true,
                maxlength: 50
            },
            //项目地址
            Search_ProjectAddress: {
                stringCheck: true,
                maxlength: 100
            }
        },
        messages: {
            Search_ProjectNo: {
                maxlength: jQuery.validator.format("亲,流水号不能超过50个")
            },
            Search_ReportNo: {
                maxlength: jQuery.validator.format("亲,报告号不能超过50个")
            },
            Search_ResidentialAreaName: {
                stringCheck: "不能含特殊字符",
                maxlength: jQuery.validator.format("亲,小区名称不能超过50个")
            },
            Search_ProjectAddress: {
                stringCheck: "不能含特殊字符",
                maxlength: jQuery.validator.format("亲,项目地址不能超过100个")
            }
        },
        success: function (label) {
            layer.close(dialog);
            $("#" + label[0].htmlFor).removeClass("error-border");
        },
        errorPlacement: function (error, element) {
            $("#" + element[0].id).addClass("error-border");
            dialog = layer.tips(error[0].innerHTML, "#" + element[0].id, {
                tips: [2, '#F99228']
            });
        }, submitHandler: function () {
            SearchProject();
        }
    });

    //项目查询
    function SearchProject() {
        if ($("#selected").valid()) {
            $('#tablist').bootstrapTable('destroy');
            tableint();
        }
    }

    //获取选中行的id
    function GetSelectRow() {
        var row = $('#tablist').bootstrapTable('getSelections');
        if (row.length > 0) {
            var value = row[0].Id;
            parent.SelectProject(value);
            cancelextractiondialog();
        } else {
            layer.msg("请选择项目!", { icon: 5, time: 1500, shade: [0.3, '#000'] });
        }

    }

    //关闭窗口
    function cancelextractiondialog() {
        parent.layer.closeAll();
    }


    function tableint() {
        $('#tablist').bootstrapTable({
            url: "/Acceptance/GetProjectList",
            method: 'post', //请求方式（*）
            striped: true, //是否显示行间隔色
            cache: false, //是否使用缓存，默认为true，所以一般情况下需要设置一下这个属性（*）
            pagination: true, //是否显示分页（*）
            sidePagination: "server", //分页方式：client客户端分页，server服务端分页（*）
            pageNumber: 1, //初始化加载第一页，默认第一页
            pageSize: 10, //每页的记录行数（*）
            pageList: [10, 25, 50, 100], //可供选择的每页的行数（*）
            strictSearch: true,
            clickToSelect: true, //是否启用点击选中行
            height: 'auto', //行高，如果没有设置height属性，表格自动根据记录条数觉得表格高度
            uniqueId: "Id", //每一行的唯一标识，一般为主键列
            cardView: false, //是否显示详细视图
            detailView: false, //是否显示父子表
            singleSelect: false,
            queryParams: function (params) {
                return {
                    //这里的键的名字和控制器的变量名必须一直，这边改动，控制器也需要改成一样的
                    condition:
                    {
                        ProjectNo: $('#Search_ProjectNo').val(), ReportNo: $('#Search_ReportNo').val(),
                        ProjectAddress: $('#Search_ProjectAddress').val(), ResidentialAreaName: $('#Search_ResidentialAreaName').val()
                    },
                    pageSize: params.limit, //页面大小
                    pageIndex: parseInt(params.offset / params.limit) + 1, //页码
                };
            }, //传递参数（*）
            columns: [
                {
                    width: '20px',
                    radio: true,
                    clickToSelect: true
                },
                {
                    title: '流水号',
                    field: 'ProjectNo',
                    align: 'left',
                    valign: 'middle'
                },
                {
                    title: '报告号',
                    field: 'ReportNo',
                    align: 'left',
                    valign: 'middle',
                }, {
                    title: '小区名称',
                    field: 'ResidentialAreaName',
                    align: 'left',
                    valign: 'middle'
                },
                {
                    title: '项目地址',
                    field: 'ProjectAddress',
                    align: 'left',
                    valign: 'middle'
                },
                {
                    title: '物业类型',
                    field: 'PropertyType',
                    align: 'left',
                    valign: 'middle'
                },
                {
                    title: '估价目的',
                    field: 'BusinessType',
                    align: 'left',
                    valign: 'middle'
                },
                {
                    title: '报告类型',
                    field: 'ReportType',
                    align: 'left',
                    valign: 'middle'
                },
                {
                    title: '项目来源',
                    field: 'ProjectSource',
                    align: 'left',
                    valign: 'middle'
                }
            ]
        });
    }

</script>